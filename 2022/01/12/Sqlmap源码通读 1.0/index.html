<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/rabbit.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/rabbit_16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="Sqlmap源码通读 1.0花了一个下午的时间看了一下SQLmap用户手册，发现以前对SQLmap的认知真是太肤浅了。 1.0主要还是看Sqlmap的基础功能和实现细节">
<meta property="og:type" content="article">
<meta property="og:title" content="sqlmap源码通读 1.0">
<meta property="og:url" content="http://example.com/2022/01/12/Sqlmap%E6%BA%90%E7%A0%81%E9%80%9A%E8%AF%BB%201.0/index.html">
<meta property="og:site_name" content="Jasontt&#39;s Blog">
<meta property="og:description" content="Sqlmap源码通读 1.0花了一个下午的时间看了一下SQLmap用户手册，发现以前对SQLmap的认知真是太肤浅了。 1.0主要还是看Sqlmap的基础功能和实现细节">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211120191640212.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211120194950636.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211120195101916.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211120201307980.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211120201332414.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123184314072.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123184334026.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123184419708.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123185342627.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123192427780.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123192506396.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123195358545.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123200106597.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123200913831.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123201300160.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123201548376.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123201709718.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211124151442667.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211124152338670.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211124154720290.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211127183902435.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211127194659375.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211127200035159.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211127200336549.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211127201921315.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211130203726347.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211130204237981.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211206140046839.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211206140706106.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211206140954358.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211206141110043.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211206141446717.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211206141544427.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211130193414009.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207160143521.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207160312902.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207161722271.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207191644488.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207193008973.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207193110200.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207193436099.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207194325930.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207195446474.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207200147236.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207204739859.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207210215547.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207210543310.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211210165757597.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211210172123327.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211210173415957.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211210190454459.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211210192009838.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211210194445492.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211210195555393.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211214174351461.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211214191454063.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211214193343059.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215152011217.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215152421341.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215153713508.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215154456661.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215154550048.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215162625545.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215202300874.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215202401388.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/KZY]XCJTV6A3K8XFYL4IHUQ.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215203737369.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215210924072.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215213508641.png">
<meta property="og:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215213527910.png">
<meta property="article:published_time" content="2022-01-12T06:06:11.000Z">
<meta property="article:modified_time" content="2022-01-14T06:30:48.292Z">
<meta property="article:author" content="Jason Tu">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="sqlmap">
<meta property="article:tag" content="工具分析">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211120191640212.png">


<link rel="canonical" href="http://example.com/2022/01/12/Sqlmap%E6%BA%90%E7%A0%81%E9%80%9A%E8%AF%BB%201.0/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://example.com/2022/01/12/Sqlmap%E6%BA%90%E7%A0%81%E9%80%9A%E8%AF%BB%201.0/","path":"2022/01/12/Sqlmap源码通读 1.0/","title":"sqlmap源码通读 1.0"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>sqlmap源码通读 1.0 | Jasontt's Blog</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Jasontt's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
        <li class="menu-item menu-item-schedule"><a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Sqlmap%E6%BA%90%E7%A0%81%E9%80%9A%E8%AF%BB-1-0"><span class="nav-number">1.</span> <span class="nav-text">Sqlmap源码通读 1.0</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8%E6%B3%95"><span class="nav-number">1.1.</span> <span class="nav-text">用法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="nav-number">1.2.</span> <span class="nav-text">目录结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-number">1.3.</span> <span class="nav-text">函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#sqlmap-py"><span class="nav-number">1.3.1.</span> <span class="nav-text">sqlmap.py</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#dirtyPatches"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">dirtyPatches()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#resolveCrossReferences"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">resolveCrossReferences()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#checkEnvironment"><span class="nav-number">1.3.1.3.</span> <span class="nav-text">checkEnvironment()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setPaths"><span class="nav-number">1.3.1.4.</span> <span class="nav-text">setPaths()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#banner"><span class="nav-number">1.3.1.5.</span> <span class="nav-text">banner()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%94%E4%B8%AA%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C%E4%B9%8B%E5%90%8E%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="nav-number">1.3.1.6.</span> <span class="nav-text">五个函数执行之后的流程</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#option-py"><span class="nav-number">1.3.2.</span> <span class="nav-text">option.py</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#init"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">init()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#controller-py"><span class="nav-number">1.3.3.</span> <span class="nav-text">controller.py</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#start"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">start()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#conf-direct-True"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">conf.direct &#x3D; True</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#checkWaf"><span class="nav-number">1.3.3.3.</span> <span class="nav-text">checkWaf()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#identYwaf"><span class="nav-number">1.3.3.4.</span> <span class="nav-text">identYwaf</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#heuristcCheckSqlInjection"><span class="nav-number">1.3.3.5.</span> <span class="nav-text">heuristcCheckSqlInjection()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#checkSqlInjection"><span class="nav-number">1.3.3.6.</span> <span class="nav-text">checkSqlInjection()</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="nav-number">1.3.3.6.1.</span> <span class="nav-text">布尔盲注</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="nav-number">1.3.3.6.2.</span> <span class="nav-text">报错注入</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="nav-number">1.3.3.6.3.</span> <span class="nav-text">时间盲注</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.3.3.6.4.</span> <span class="nav-text">联合查询</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E5%90%8E"><span class="nav-number">1.4.</span> <span class="nav-text">最后</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jason Tu"
      src="/images/touxiang.jpg">
  <p class="site-author-name" itemprop="name">Jason Tu</p>
  <div class="site-description" itemprop="description">一只谦虚的兔子</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">17</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://4xwi11.github.io/" title="https:&#x2F;&#x2F;4xwi11.github.io&#x2F;" rel="noopener" target="_blank">4xwi11</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://scr1pt-kid.github.io/" title="https:&#x2F;&#x2F;scr1pt-kid.github.io&#x2F;" rel="noopener" target="_blank">Scr1pt</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.yuque.com/jinjinshigekeaigui" title="https:&#x2F;&#x2F;www.yuque.com&#x2F;jinjinshigekeaigui" rel="noopener" target="_blank">Jiang</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.cnblogs.com/yunqian2017" title="https:&#x2F;&#x2F;www.cnblogs.com&#x2F;yunqian2017" rel="noopener" target="_blank">Openg</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/12/Sqlmap%E6%BA%90%E7%A0%81%E9%80%9A%E8%AF%BB%201.0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="Jason Tu">
      <meta itemprop="description" content="一只谦虚的兔子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jasontt's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          sqlmap源码通读 1.0
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-12 14:06:11" itemprop="dateCreated datePublished" datetime="2022-01-12T14:06:11+08:00">2022-01-12</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-14 14:30:48" itemprop="dateModified" datetime="2022-01-14T14:30:48+08:00">2022-01-14</time>
      </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="Sqlmap源码通读-1-0"><a href="#Sqlmap源码通读-1-0" class="headerlink" title="Sqlmap源码通读 1.0"></a>Sqlmap源码通读 1.0</h1><p>花了一个下午的时间看了一下<a target="_blank" rel="noopener" href="https://sqlmap.campfire.ga/usage">SQLmap用户手册</a>，发现以前对SQLmap的认知真是太肤浅了。</p>
<p>1.0主要还是看Sqlmap的基础功能和实现细节</p>
<span id="more"></span>

<p>2.0打算看看tamper和其他模块实现（待码）</p>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br></pre></td><td class="code"><pre><span class="line">用法：python sqlmap.py [选项]</span><br><span class="line">​</span><br><span class="line">选项：</span><br><span class="line">  -h, --help            显示基本帮助信息并退出</span><br><span class="line">  -hh                   显示高级帮助信息并退出</span><br><span class="line">  --version             显示程序版本信息并退出</span><br><span class="line">  -v VERBOSE            输出信息详细程度级别：0-6（默认为 1）</span><br><span class="line">​</span><br><span class="line">  目标：</span><br><span class="line">    至少提供一个以下选项以指定目标</span><br><span class="line">​</span><br><span class="line">    -d DIRECT           直接连接数据库</span><br><span class="line">    -u URL, --url=URL   目标 URL（例如：&quot;http://www.site.com/vuln.php?id=1&quot;）</span><br><span class="line">    -l LOGFILE          从 Burp 或 WebScarab 代理的日志文件中解析目标地址</span><br><span class="line">    -m BULKFILE         从文本文件中获取批量目标</span><br><span class="line">    -r REQUESTFILE      从文件中读取 HTTP 请求</span><br><span class="line">    -g GOOGLEDORK       使用 Google dork 结果作为目标</span><br><span class="line">    -c CONFIGFILE       从 INI 配置文件中加载选项</span><br><span class="line">​</span><br><span class="line">  请求：</span><br><span class="line">    以下选项可以指定连接目标地址的方式</span><br><span class="line">​</span><br><span class="line">    --method=METHOD     强制使用提供的 HTTP 方法（例如：PUT）</span><br><span class="line">    --data=DATA         使用 POST 发送数据串（例如：&quot;id=1&quot;）</span><br><span class="line">    --param-del=PARA..  设置参数值分隔符（例如：&amp;）</span><br><span class="line">    --cookie=COOKIE     指定 HTTP Cookie（例如：&quot;PHPSESSID=a8d127e..&quot;）</span><br><span class="line">    --cookie-del=COO..  设置 cookie 分隔符（例如：;）</span><br><span class="line">    --load-cookies=L..  指定以 Netscape/wget 格式存放 cookies 的文件</span><br><span class="line">    --drop-set-cookie   忽略 HTTP 响应中的 Set-Cookie 参数</span><br><span class="line">    --user-agent=AGENT  指定 HTTP User-Agent</span><br><span class="line">    --random-agent      使用随机的 HTTP User-Agent</span><br><span class="line">    --host=HOST         指定 HTTP Host</span><br><span class="line">    --referer=REFERER   指定 HTTP Referer</span><br><span class="line">    -H HEADER, --hea..  设置额外的 HTTP 头参数（例如：&quot;X-Forwarded-For: 127.0.0.1&quot;）</span><br><span class="line">    --headers=HEADERS   设置额外的 HTTP 头参数（例如：&quot;Accept-Language: fr\nETag: 123&quot;）</span><br><span class="line">    --auth-type=AUTH..  HTTP 认证方式（Basic，Digest，NTLM 或 PKI）</span><br><span class="line">    --auth-cred=AUTH..  HTTP 认证凭证（username:password）</span><br><span class="line">    --auth-file=AUTH..  HTTP 认证 PEM 证书/私钥文件</span><br><span class="line">    --ignore-code=IG..  忽略（有问题的）HTTP 错误码（例如：401）</span><br><span class="line">    --ignore-proxy      忽略系统默认代理设置</span><br><span class="line">    --ignore-redirects  忽略重定向尝试</span><br><span class="line">    --ignore-timeouts   忽略连接超时</span><br><span class="line">    --proxy=PROXY       使用代理连接目标 URL</span><br><span class="line">    --proxy-cred=PRO..  使用代理进行认证（username:password）</span><br><span class="line">    --proxy-file=PRO..  从文件中加载代理列表</span><br><span class="line">    --tor               使用 Tor 匿名网络</span><br><span class="line">    --tor-port=TORPORT  设置 Tor 代理端口代替默认端口</span><br><span class="line">    --tor-type=TORTYPE  设置 Tor 代理方式（HTTP，SOCKS4 或 SOCKS5（默认））</span><br><span class="line">    --check-tor         检查是否正确使用了 Tor</span><br><span class="line">    --delay=DELAY       设置每个 HTTP 请求的延迟秒数</span><br><span class="line">    --timeout=TIMEOUT   设置连接响应的有效秒数（默认为 30）</span><br><span class="line">    --retries=RETRIES   连接超时时重试次数（默认为 3）</span><br><span class="line">    --randomize=RPARAM  随机更改给定的参数值</span><br><span class="line">    --safe-url=SAFEURL  测试过程中可频繁访问且合法的 URL 地址（译者注：</span><br><span class="line">                        有些网站在你连续多次访问错误地址时会关闭会话连接，</span><br><span class="line">                        后面的“请求”小节有详细说明）</span><br><span class="line">    --safe-post=SAFE..  使用 POST 方法发送合法的数据</span><br><span class="line">    --safe-req=SAFER..  从文件中加载合法的 HTTP 请求</span><br><span class="line">    --safe-freq=SAFE..  每访问两次给定的合法 URL 才发送一次测试请求</span><br><span class="line">    --skip-urlencode    不对 payload 数据进行 URL 编码</span><br><span class="line">    --csrf-token=CSR..  设置网站用来反 CSRF 攻击的 token</span><br><span class="line">    --csrf-url=CSRFURL  指定可提取防 CSRF 攻击 token 的 URL</span><br><span class="line">    --force-ssl         强制使用 SSL/HTTPS</span><br><span class="line">    --hpp               使用 HTTP 参数污染攻击</span><br><span class="line">    --eval=EVALCODE     在发起请求前执行给定的 Python 代码（例如：</span><br><span class="line">                        &quot;import hashlib;id2=hashlib.md5(id).hexdigest()&quot;）</span><br><span class="line">​</span><br><span class="line">  优化：</span><br><span class="line">    以下选项用于优化 sqlmap 性能</span><br><span class="line">​</span><br><span class="line">    -o                  开启所有优化开关</span><br><span class="line">    --predict-output    预测常用请求的输出</span><br><span class="line">    --keep-alive        使用持久的 HTTP(S) 连接</span><br><span class="line">    --null-connection   仅获取页面大小而非实际的 HTTP 响应</span><br><span class="line">    --threads=THREADS   设置 HTTP(S) 请求并发数最大值（默认为 1）</span><br><span class="line">​</span><br><span class="line">  注入：</span><br><span class="line">    以下选项用于指定要测试的参数，</span><br><span class="line">    提供自定义注入 payloads 和篡改参数的脚本</span><br><span class="line">​</span><br><span class="line">    -p TESTPARAMETER    指定需要测试的参数</span><br><span class="line">    --skip=SKIP         指定要跳过的参数</span><br><span class="line">    --skip-static       指定跳过非动态参数</span><br><span class="line">    --param-exclude=..  用正则表达式排除参数（例如：&quot;ses&quot;）</span><br><span class="line">    --dbms=DBMS         指定后端 DBMS（Database Management System，</span><br><span class="line">                        数据库管理系统）类型（例如：MySQL）</span><br><span class="line">    --dbms-cred=DBMS..  DBMS 认证凭据（username:password）</span><br><span class="line">    --os=OS             指定后端 DBMS 的操作系统类型</span><br><span class="line">    --invalid-bignum    将无效值设置为大数</span><br><span class="line">    --invalid-logical   对无效值使用逻辑运算</span><br><span class="line">    --invalid-string    对无效值使用随机字符串</span><br><span class="line">    --no-cast           关闭 payload 构造机制</span><br><span class="line">    --no-escape         关闭字符串转义机制</span><br><span class="line">    --prefix=PREFIX     注入 payload 的前缀字符串</span><br><span class="line">    --suffix=SUFFIX     注入 payload 的后缀字符串</span><br><span class="line">    --tamper=TAMPER     用给定脚本修改注入数据</span><br><span class="line">​</span><br><span class="line">  检测：</span><br><span class="line">    以下选项用于自定义检测方式</span><br><span class="line">​</span><br><span class="line">    --level=LEVEL       设置测试等级（1-5，默认为 1）</span><br><span class="line">    --risk=RISK         设置测试风险等级（1-3，默认为 1）</span><br><span class="line">    --string=STRING     用于确定查询结果为真时的字符串</span><br><span class="line">    --not-string=NOT..  用于确定查询结果为假时的字符串</span><br><span class="line">    --regexp=REGEXP     用于确定查询结果为真时的正则表达式</span><br><span class="line">    --code=CODE         用于确定查询结果为真时的 HTTP 状态码</span><br><span class="line">    --text-only         只根据页面文本内容对比页面</span><br><span class="line">    --titles            只根据页面标题对比页面</span><br><span class="line">​</span><br><span class="line">  技术：</span><br><span class="line">    以下选项用于调整特定 SQL 注入技术的测试方法</span><br><span class="line">​</span><br><span class="line">    --technique=TECH    使用的 SQL 注入技术（默认为“BEUSTQ”，译者注：</span><br><span class="line">                        B: Boolean-based blind SQL injection（布尔型盲注）</span><br><span class="line">                        E: Error-based SQL injection（报错型注入）</span><br><span class="line">                        U: UNION query SQL injection（联合查询注入）</span><br><span class="line">                        S: Stacked queries SQL injection（堆叠查询注入）</span><br><span class="line">                        T: Time-based blind SQL injection（时间型盲注）</span><br><span class="line">                        Q: inline Query injection（内联查询注入）</span><br><span class="line">    --time-sec=TIMESEC  延迟 DBMS 的响应秒数（默认为 5）</span><br><span class="line">    --union-cols=UCOLS  设置联合查询注入测试的列数目范围</span><br><span class="line">    --union-char=UCHAR  用于暴力猜解列数的字符</span><br><span class="line">    --union-from=UFROM  设置联合查询注入 FROM 处用到的表</span><br><span class="line">    --dns-domain=DNS..  设置用于 DNS 渗出攻击的域名（译者注：</span><br><span class="line">                        推荐阅读《在SQL注入中使用DNS获取数据》</span><br><span class="line">                        http://cb.drops.wiki/drops/tips-5283.html，</span><br><span class="line">                        在后面的“技术”小节中也有相应解释）</span><br><span class="line">    --second-url=SEC..  设置二阶响应的结果显示页面的 URL（译者注：</span><br><span class="line">                        该选项用于 SQL 二阶注入）</span><br><span class="line">    --second-req=SEC..  从文件读取 HTTP 二阶请求</span><br><span class="line">​</span><br><span class="line">  指纹识别：</span><br><span class="line">    -f, --fingerprint   执行广泛的 DBMS 版本指纹识别</span><br><span class="line">​</span><br><span class="line">  枚举：</span><br><span class="line">    以下选项用于获取后端 DBMS 的信息，结构和数据表中的数据。</span><br><span class="line">    此外，还可以运行你输入的 SQL 语句</span><br><span class="line">​</span><br><span class="line">    -a, --all           获取所有信息、数据</span><br><span class="line">    -b, --banner        获取 DBMS banner</span><br><span class="line">    --current-user      获取 DBMS 当前用户</span><br><span class="line">    --current-db        获取 DBMS 当前数据库</span><br><span class="line">    --hostname          获取 DBMS 服务器的主机名</span><br><span class="line">    --is-dba            探测 DBMS 当前用户是否为 DBA（数据库管理员）</span><br><span class="line">    --users             枚举出 DBMS 所有用户</span><br><span class="line">    --passwords         枚举出 DBMS 所有用户的密码哈希</span><br><span class="line">    --privileges        枚举出 DBMS 所有用户特权级</span><br><span class="line">    --roles             枚举出 DBMS 所有用户角色</span><br><span class="line">    --dbs               枚举出 DBMS 所有数据库</span><br><span class="line">    --tables            枚举出 DBMS 数据库中的所有表</span><br><span class="line">    --columns           枚举出 DBMS 表中的所有列</span><br><span class="line">    --schema            枚举出 DBMS 所有模式</span><br><span class="line">    --count             获取数据表数目</span><br><span class="line">    --dump              导出 DBMS 数据库表项</span><br><span class="line">    --dump-all          导出所有 DBMS 数据库表项</span><br><span class="line">    --search            搜索列，表和/或数据库名</span><br><span class="line">    --comments          枚举数据时检查 DBMS 注释</span><br><span class="line">    -D DB               指定要枚举的 DBMS 数据库</span><br><span class="line">    -T TBL              指定要枚举的 DBMS 数据表</span><br><span class="line">    -C COL              指定要枚举的 DBMS 数据列</span><br><span class="line">    -X EXCLUDE          指定不枚举的 DBMS 标识符</span><br><span class="line">    -U USER             指定枚举的 DBMS 用户</span><br><span class="line">    --exclude-sysdbs    枚举所有数据表时，指定排除特定系统数据库</span><br><span class="line">    --pivot-column=P..  指定主列</span><br><span class="line">    --where=DUMPWHERE   在转储表时使用 WHERE 条件语句</span><br><span class="line">    --start=LIMITSTART  指定要导出的数据表条目开始行数</span><br><span class="line">    --stop=LIMITSTOP    指定要导出的数据表条目结束行数</span><br><span class="line">    --first=FIRSTCHAR   指定获取返回查询结果的开始字符位</span><br><span class="line">    --last=LASTCHAR     指定获取返回查询结果的结束字符位</span><br><span class="line">    --sql-query=QUERY   指定要执行的 SQL 语句</span><br><span class="line">    --sql-shell         调出交互式 SQL shell</span><br><span class="line">    --sql-file=SQLFILE  执行文件中的 SQL 语句</span><br><span class="line">​</span><br><span class="line">  暴力破解：</span><br><span class="line">    以下选项用于暴力破解测试</span><br><span class="line">​</span><br><span class="line">    --common-tables     检测常见的表名是否存在</span><br><span class="line">    --common-columns    检测常用的列名是否存在</span><br><span class="line">​</span><br><span class="line">  用户自定义函数注入：</span><br><span class="line">    以下选项用于创建用户自定义函数</span><br><span class="line">​</span><br><span class="line">    --udf-inject        注入用户自定义函数</span><br><span class="line">    --shared-lib=SHLIB  共享库的本地路径</span><br><span class="line">​</span><br><span class="line">  访问文件系统：</span><br><span class="line">    以下选项用于访问后端 DBMS 的底层文件系统</span><br><span class="line">​</span><br><span class="line">    --file-read=FILE..  读取后端 DBMS 文件系统中的文件</span><br><span class="line">    --file-write=FIL..  写入到后端 DBMS 文件系统中的文件</span><br><span class="line">    --file-dest=FILE..  使用绝对路径写入到后端 DBMS 中的文件</span><br><span class="line">​</span><br><span class="line">  访问操作系统：</span><br><span class="line">    以下选项用于访问后端 DBMS 的底层操作系统</span><br><span class="line">​</span><br><span class="line">    --os-cmd=OSCMD      执行操作系统命令</span><br><span class="line">    --os-shell          调出交互式操作系统 shell</span><br><span class="line">    --os-pwn            调出 OOB shell，Meterpreter 或 VNC</span><br><span class="line">    --os-smbrelay       一键调出 OOB shell，Meterpreter 或 VNC</span><br><span class="line">    --os-bof            利用存储过程的缓冲区溢出</span><br><span class="line">    --priv-esc          数据库进程用户提权</span><br><span class="line">    --msf-path=MSFPATH  Metasploit 框架的本地安装路径</span><br><span class="line">    --tmp-path=TMPPATH  远程临时文件目录的绝对路径</span><br><span class="line">​</span><br><span class="line">  访问 Windows 注册表：</span><br><span class="line">    以下选项用于访问后端 DBMS 的 Windows 注册表</span><br><span class="line">​</span><br><span class="line">    --reg-read          读取一个 Windows 注册表键值</span><br><span class="line">    --reg-add           写入一个 Windows 注册表键值数据</span><br><span class="line">    --reg-del           删除一个 Windows 注册表键值</span><br><span class="line">    --reg-key=REGKEY    指定 Windows 注册表键</span><br><span class="line">    --reg-value=REGVAL  指定 Windows 注册表键值</span><br><span class="line">    --reg-data=REGDATA  指定 Windows 注册表键值数据</span><br><span class="line">    --reg-type=REGTYPE  指定 Windows 注册表键值类型</span><br><span class="line">​</span><br><span class="line">  通用选项：</span><br><span class="line">    以下选项用于设置通用的参数</span><br><span class="line">​</span><br><span class="line">    -s SESSIONFILE      从文件（.sqlite）中读入会话信息</span><br><span class="line">    -t TRAFFICFILE      保存所有 HTTP 流量记录到指定文本文件</span><br><span class="line">    --batch             从不询问用户输入，使用默认配置</span><br><span class="line">    --binary-fields=..  具有二进制值的结果字段（例如：&quot;digest&quot;）</span><br><span class="line">    --check-internet    在访问目标之前检查是否正常连接互联网</span><br><span class="line">    --crawl=CRAWLDEPTH  从目标 URL 开始爬取网站</span><br><span class="line">    --crawl-exclude=..  用正则表达式筛选爬取的页面（例如：&quot;logout&quot;）</span><br><span class="line">    --csv-del=CSVDEL    指定输出到 CVS 文件时使用的分隔符（默认为“,”）</span><br><span class="line">    --charset=CHARSET   指定 SQL 盲注字符集（例如：&quot;0123456789abcdef&quot;）</span><br><span class="line">    --dump-format=DU..  导出数据的格式（CSV（默认），HTML 或 SQLITE）</span><br><span class="line">    --encoding=ENCOD..  指定获取数据时使用的字符编码（例如：GBK）</span><br><span class="line">    --eta               显示每个结果输出的预计到达时间</span><br><span class="line">    --flush-session     清空当前目标的会话文件</span><br><span class="line">    --forms             解析并测试目标 URL 的表单</span><br><span class="line">    --fresh-queries     忽略存储在会话文件中的查询结果</span><br><span class="line">    --har=HARFILE       将所有 HTTP 流量记录到一个 HAR 文件中</span><br><span class="line">    --hex               获取数据时使用 hex 转换</span><br><span class="line">    --output-dir=OUT..  自定义输出目录路径</span><br><span class="line">    --parse-errors      从响应中解析并显示 DBMS 错误信息</span><br><span class="line">    --preprocess=PRE..  使用给定脚本预处理响应数据</span><br><span class="line">    --repair            重新导出具有未知字符的数据（?）</span><br><span class="line">    --save=SAVECONFIG   将选项设置保存到一个 INI 配置文件</span><br><span class="line">    --scope=SCOPE       用正则表达式从提供的代理日志中过滤目标</span><br><span class="line">    --test-filter=TE..  根据 payloads 和/或标题（例如：ROW）选择测试</span><br><span class="line">    --test-skip=TEST..  根据 payloads 和/或标题（例如：BENCHMARK）跳过部分测试</span><br><span class="line">    --update            更新 sqlmap</span><br><span class="line">​</span><br><span class="line">  杂项：</span><br><span class="line">    -z MNEMONICS        使用短助记符（例如：“flu,bat,ban,tec=EU”）</span><br><span class="line">    --alert=ALERT       在找到 SQL 注入时运行 OS 命令</span><br><span class="line">    --answers=ANSWERS   设置预定义回答（例如：“quit=N,follow=N”）</span><br><span class="line">    --beep              出现问题提醒或在发现 SQL 注入时发出提示音</span><br><span class="line">    --cleanup           指定移除 DBMS 中的特定的 UDF 或者数据表</span><br><span class="line">    --dependencies      检查 sqlmap 缺少（可选）的依赖</span><br><span class="line">    --disable-coloring  关闭彩色控制台输出</span><br><span class="line">    --gpage=GOOGLEPAGE  指定页码使用 Google dork 结果</span><br><span class="line">    --identify-waf      针对 WAF/IPS 防护进行彻底的测试</span><br><span class="line">    --mobile            使用 HTTP User-Agent 模仿智能手机</span><br><span class="line">    --offline           在离线模式下工作（仅使用会话数据）</span><br><span class="line">    --purge             安全删除 sqlmap data 目录所有内容</span><br><span class="line">    --skip-waf          跳过启发式检测 WAF/IPS 防护</span><br><span class="line">    --smart             只有在使用启发式检测时才进行彻底的测试</span><br><span class="line">    --sqlmap-shell      调出交互式 sqlmap shell</span><br><span class="line">    --tmp-dir=TMPDIR    指定用于存储临时文件的本地目录</span><br><span class="line">    --web-root=WEBROOT  指定 Web 服务器根目录（例如：&quot;/var/www&quot;）</span><br><span class="line">    --wizard            适合初级用户的向导界面</span><br></pre></td></tr></table></figure>

<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── data  //数据库注入检测荷载、用户自定义攻击荷载、字典、shell命令、数据库触发顺序</span><br><span class="line">├── doc </span><br><span class="line">├── extra  //额外功能：运行cmd、shellcode等</span><br><span class="line">├── lib  //Sqlmap的连接库，注入请求的参数、提权操作等</span><br><span class="line">├── LICENSE</span><br><span class="line">├── plugins  //各种数据库信息和数据库通用事项</span><br><span class="line">├── README.md</span><br><span class="line">├── sqlmapapi.py  //sqlmap的api文件</span><br><span class="line">├── sqlmapapi.yaml  //sqlmap的api文档</span><br><span class="line">├── sqlmap.conf  //sqlmap配置文件</span><br><span class="line">├── sqlmap.py  //sqlmap主程序文件</span><br><span class="line">├── tamper  //绕过脚本</span><br><span class="line">└── thirdparty  //第三方插件</span><br></pre></td></tr></table></figure>

<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>Sqlmap版本：1.5.11.9#dev</p>
<p><strong>ps</strong>：刚开始看的时候用的VScode，后面换了Pycharm，前后截图看着难受的见谅= =</p>
<h3 id="sqlmap-py"><a href="#sqlmap-py" class="headerlink" title="sqlmap.py"></a>sqlmap.py</h3><p>程序初始化以后，main()函数首先执行了五个函数</p>
<h4 id="dirtyPatches"><a href="#dirtyPatches" class="headerlink" title="dirtyPatches()"></a>dirtyPatches()</h4><p>对于程序中一些问题的处理和修复</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211120191640212.png" alt="image-20211120191640212"></p>
<ul>
<li>设置<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/section/1368319">httplib</a>最大长度来接收长结果行</li>
<li>在sqlmap分块的情况下防止双分块编码</li>
<li>在 Windows 操作系统上添加对 <strong>inet_pton()</strong> 的支持（inet_pton()为IP地址转换函数），然后编码替换把cp65001替换为UTF-8</li>
<li>在二进制数据检索的情况下防止过多的“guessing”</li>
<li>…</li>
</ul>
<p>对sqlmap的功能影响似乎不是很大，可能是为了优化体验和进行一些基本设置</p>
<h4 id="resolveCrossReferences"><a href="#resolveCrossReferences" class="headerlink" title="resolveCrossReferences()"></a>resolveCrossReferences()</h4><p>解决模块的交叉引用问题</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211120194950636.png" alt="image-20211120194950636"></p>
<p>对一些子程序中的函数进行重写赋值来消除交叉引用问题</p>
<h4 id="checkEnvironment"><a href="#checkEnvironment" class="headerlink" title="checkEnvironment()"></a>checkEnvironment()</h4><p>环境检测函数</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211120195101916.png" alt="image-20211120195101916"></p>
<p>调用**modulePath()**获取程序路径，判断程序是否被py2exe（py2exe是一个将python脚本转换成windows上的可独立执行的可执行程序的工具）打包成了exe，打包后将无法用file获取文件路径。</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211120201307980.png" alt="image-20211120201307980"></p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211120201332414.png" alt="image-20211120201332414"></p>
<p>用**getUnicode()**返回unicode编码路径，防止乱码。</p>
<p>用**LooseVersion()**判断python版本，python版本过低则报错退出</p>
<p>导入对pip安装环境的补丁，设置了一些系统环境变量</p>
<h4 id="setPaths"><a href="#setPaths" class="headerlink" title="setPaths()"></a>setPaths()</h4><p>配置Sqlmap文件和目录的绝对路径</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123184314072.png" alt="image-20211123184314072"></p>
<p>判断扩展名为”.txt”, “.xml”, “.tx_”的文件是否存在并且可读</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123184334026.png" alt="image-20211123184334026"></p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123184419708.png" alt="image-20211123184419708"></p>
<p>paths的值为Sqlmap自定义的一个字典类型AttribDict<strong>（这块不是很懂）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># sqlmap paths</span><br><span class="line">paths = AttribDict()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>This class defines the dictionary with added capability to access members as attributes</p>
<p>此类定义了具有访问成员作为属性的附加功能的字典</p>
<p>就是说可以通过访问属性的方式来访问键值</p>
</blockquote>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123185342627.png" alt="image-20211123185342627"></p>
<p>其中定义了<code>__deepcopy__</code>，为了解决字典赋值传递后<strong>浅拷贝</strong>会修改原数据的问题</p>
<blockquote>
<ul>
<li><strong>直接赋值：</strong>其实就是对象的引用（别名）。</li>
<li><strong>浅拷贝(copy)：</strong>拷贝父对象，不会拷贝对象的内部的子对象。</li>
<li><strong>深拷贝(deepcopy)：</strong> copy 模块的 deepcopy 方法，完全拷贝了父对象及其子对象。</li>
</ul>
</blockquote>
<h4 id="banner"><a href="#banner" class="headerlink" title="banner()"></a>banner()</h4><p>函数判断执行参数中是否包含”–version”或者”–api”参数，或者在配置中是否将disableBanner设置为True，没有就将BANNER字符串赋值给 <strong>“_”</strong></p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123192427780.png" alt="image-20211123192427780"></p>
<p><strong>BANNER</strong>就是Sqlmap开始运行时打印出来的字符画</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123192506396.png" alt="image-20211123192506396"></p>
<h4 id="五个函数执行之后的流程"><a href="#五个函数执行之后的流程" class="headerlink" title="五个函数执行之后的流程"></a>五个函数执行之后的流程</h4><p>接下来是对命令行参数的操作</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123195358545.png" alt="image-20211123195358545"></p>
<p><strong>cmdLineParse()<strong>：该函数解析命令行参数和实参。使用了<a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/argparse.html#module-argparse"><code>argparse</code></a> — 命令行选项、参数和子命令解析器。将获取的命令行参数选项进行判断、拆分转变成dict键值对的形式存入</strong>cmdLineOptions</strong>(为一个<strong>AttribDict()</strong>)。</p>
<p>接着<strong>cmdLineOptions</strong>传入<strong>initOptions()</strong></p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123200106597.png" alt="image-20211123200106597"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_setConfAttributes()  //初始化某些属性值为空</span><br><span class="line">_setKnowledgeBaseAttributes()  //初始化某些属性值到&quot;知识库&quot;中</span><br><span class="line">_mergeOptions(inputOptions, overrideOptions)  //将配置项中的参数和命令行获得的参数选项以及缺省选项进行合并，函数执行完毕将会将字典 mergedOptions 的值进行更新</span><br></pre></td></tr></table></figure>



<p>判断是否标准输入</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123200913831.png" alt="image-20211123200913831"></p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123201300160.png" alt="image-20211123201300160"></p>
<p>判断是否调用api，如果是将会引入几个新的包，并覆盖系统标准输出和标准错误</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123201548376.png" alt="image-20211123201548376"></p>
<p>判断过后打印法律声明和时间</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211123201709718.png" alt="image-20211123201709718"></p>
<p>接着执行init()函数，该函数定义在<strong>lib/core/option.py</strong></p>
<p>注释写的是：将属性设置为配置和知识库单例，基于命令行和配置文件选项。具体分析于下文。</p>
<p>之后执行两个测试函数smokeTest、vulnTest。不测试则导入包，判断<strong>conf.profile</strong>，其中**profile()**的作用写的是：以图形显示分析数据，不是很理解到底干了啥</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211124151442667.png" alt="image-20211124151442667"></p>
<p><strong>conf.profile</strong>默认为空，直接到<strong>else</strong>部分</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211124152338670.png" alt="image-20211124152338670"></p>
<p>在<strong>if</strong>判断中</p>
<blockquote>
<p>#Crawl the website starting from the target URL.</p>
<p>conf.crawlDepth = 0</p>
<p># Scan multiple targets enlisted in a given textual file</p>
<p>bulkFile = </p>
</blockquote>
<p>首次运行<strong>if</strong>判断条件不成立，直接执行start()，start()单独分析。</p>
<p>接下来一堆<strong>except</strong>就不分析了。</p>
<p><strong>finally</strong>中主要是给出一些提示信息（例如：<code>&quot;your sqlmap version is outdated&quot;</code>）、清除临时目录、清除线程、清除配置等文件。</p>
<p>在最后判断命令行参数中是否存在<code>sqlmapShell</code>，如果有清除一波以后再次执行**main()**。</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211124154720290.png" alt="image-20211124154720290"></p>
<h3 id="option-py"><a href="#option-py" class="headerlink" title="option.py"></a>option.py</h3><p>命令行参数处理</p>
<h4 id="init"><a href="#init" class="headerlink" title="init()"></a>init()</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">注释Google翻译：</span><br><span class="line">--将属性设置为配置和知识库单例</span><br><span class="line">--基于命令行和配置文件选项。</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Set attributes into both configuration and knowledge base singletons</span></span><br><span class="line"><span class="string">    based upon command line and configuration file options.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    _useWizardInterface() <span class="comment">#为初学者提供简单的向导界面 开头用法中的 --wizard</span></span><br><span class="line">    setVerbosity() <span class="comment">#此函数设置 sqlmap 输出消息的详细程度  详见：置顶手册-&gt;用法-&gt;输出详细等级</span></span><br><span class="line">    _saveConfig() <span class="comment">#将命令行选项保存为sqlmap配置ini文件格式</span></span><br><span class="line">    _setRequestFromFile() <span class="comment">#从文件中设置http请求 -r</span></span><br><span class="line">    _cleanupOptions()  <span class="comment">#清除配置选项</span></span><br><span class="line">    _cleanupEnvironment() <span class="comment">#清理环境（例如，--shell后的残留）</span></span><br><span class="line">    _purge() <span class="comment">#安全删除（清除）sqlmap 数据目录</span></span><br><span class="line">    _checkDependencies() <span class="comment">#检测丢失的依赖</span></span><br><span class="line">    _createHomeDirectories() <span class="comment">#在sqlmap的主目录中创建目录</span></span><br><span class="line">    _createTemporaryDirectory() <span class="comment">#为这次运行创建临时目录</span></span><br><span class="line">    _basicOptionValidation() <span class="comment">#检查选项是否有效</span></span><br><span class="line">    _setProxyList() <span class="comment">#设置代理列表 --proxy</span></span><br><span class="line">    _setTorProxySettings() //设置Tor代理 --tor</span><br><span class="line">    _setDNSServer() <span class="comment">#设置DNS服务器 --dns-domain</span></span><br><span class="line">    _adjustLoggingFormatter() <span class="comment">#用于解决推理模式下日志信息和检索数据信息重叠导致的行删除问题</span></span><br><span class="line">    _setMultipleTargets() <span class="comment">#多目标模式下运行，只定义一个配置参数</span></span><br><span class="line">    _listTamperingFunctions() <span class="comment">#列出可用的Tamper功能</span></span><br><span class="line">    _setTamperingFunctions() <span class="comment">#设置Tamper脚本 --temper</span></span><br><span class="line">    _setPreprocessFunctions() <span class="comment">#从给定脚本加载预处理功能 --preprocess</span></span><br><span class="line">    _setPostprocessFunctions() <span class="comment">#从给定脚本加载后处理功能</span></span><br><span class="line">    _setTrafficOutputFP() <span class="comment">#设置记录http日志</span></span><br><span class="line">    _setupHTTPCollector() <span class="comment">#设置http收集器</span></span><br><span class="line">    _setHttpChunked() <span class="comment">#设置http chunked编码</span></span><br><span class="line">    _checkWebSocket() <span class="comment">#检测websocket-client模块调用</span></span><br><span class="line">    parseTargetDirect() <span class="comment">#解析目标 dbms 并将一些属性设置到配置中</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">any</span>((conf.url, conf.logFile, conf.bulkFile, conf.requestFile, conf.googleDork, conf.stdinPipe)):</span><br><span class="line">    <span class="comment">#如果设置了上述内容则配置http</span></span><br><span class="line">        _setHostname() <span class="comment">#设置hostname</span></span><br><span class="line">        _setHTTPTimeout() <span class="comment">#设置超时</span></span><br><span class="line">        _setHTTPExtraHeaders() <span class="comment">#设置headers</span></span><br><span class="line">        _setHTTPCookies() <span class="comment">#设置Cookie</span></span><br><span class="line">        _setHTTPReferer() <span class="comment">#设置Referer</span></span><br><span class="line">        _setHTTPHost() <span class="comment">#设置Host</span></span><br><span class="line">        _setHTTPUserAgent() <span class="comment">#设置UserAgent</span></span><br><span class="line">        _setHTTPAuthentication() <span class="comment">#设置Authentication</span></span><br><span class="line">        _setHTTPHandlers() <span class="comment">#检查并设置所有 HTTP 请求的 HTTP/SOCKS 代理</span></span><br><span class="line">        _setDNSCache() <span class="comment">#设置DNSCache（具体作用可以百度一下，和缓存差不多）</span></span><br><span class="line">        _setSocketPreConnect() <span class="comment">#创建socket.create_connection 的预连接</span></span><br><span class="line">        _setSafeVisit() <span class="comment">#检查并设置安全访问选项</span></span><br><span class="line">        _doSearch() <span class="comment">#使用搜索引擎搜索并存储结果</span></span><br><span class="line">        _setStdinPipeTargets() <span class="comment">#使用标准输入解析目标列表</span></span><br><span class="line">        _setBulkMultipleTargets() <span class="comment">#从指定的批量文件解析多个目标</span></span><br><span class="line">        _checkTor() <span class="comment">#检查Tor代理</span></span><br><span class="line">        _setCrawler() <span class="comment">#设置爬虫</span></span><br><span class="line">        _findPageForms() <span class="comment">#查找页面表单</span></span><br><span class="line">        _setDBMS() <span class="comment">#强制设置DBMS --dbms</span></span><br><span class="line">        _setTechnique() <span class="comment">#设置注入技术 --technique 详见上文&quot;用法&quot;部分</span></span><br><span class="line"></span><br><span class="line">    _setThreads() <span class="comment">#设置线程</span></span><br><span class="line">    _setOS() <span class="comment">#强制设置系统</span></span><br><span class="line">    _setWriteFile() <span class="comment">#写入文件</span></span><br><span class="line">    _setMetasploit() <span class="comment">#设置Metasploit</span></span><br><span class="line">    _setDBMSAuthentication() <span class="comment">#设置DBMS验证（身份认证）</span></span><br><span class="line">    loadBoundaries() <span class="comment">#加载Boundaries</span></span><br><span class="line">    loadPayloads() <span class="comment">#加载Payloads</span></span><br><span class="line">    _setPrefixSuffix() </span><br><span class="line">    update() <span class="comment">#更新sqlmap</span></span><br><span class="line">    _loadQueries() <span class="comment">#从 &#x27;xml/queries.xml&#x27; file.loadQueries 加载查询</span></span><br></pre></td></tr></table></figure>

<h3 id="controller-py"><a href="#controller-py" class="headerlink" title="controller.py"></a>controller.py</h3><h4 id="start"><a href="#start" class="headerlink" title="start()"></a>start()</h4><p>该函数对URL稳定性，所有GET、POST、Cookie和User-Agent参数进行检查，检查它们是否动态且受到Sql注入影响</p>
<p>创建hashFile。</p>
<h4 id="conf-direct-True"><a href="#conf-direct-True" class="headerlink" title="conf.direct = True"></a>conf.direct = True</h4><p><strong>conf.direct <strong>当参数存在 -d（直接连接数据库）时为</strong>True</strong>，否则将绕过直接走下面的步骤</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211127183902435.png" alt="image-20211127183902435"></p>
<p><strong>initTargetEnv()</strong></p>
<p>初始化目标环境，完成全局变量 conf 和 kb 的初始化工作（是否有自定义注入点，是否指定数据库）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initTargetEnv</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Initialize target environment.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> conf.multipleTargets:</span><br><span class="line">        <span class="keyword">if</span> conf.hashDB:</span><br><span class="line">            conf.hashDB.close()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> conf.cj:</span><br><span class="line">            resetCookieJar(conf.cj)</span><br><span class="line"></span><br><span class="line">        threadData = getCurrentThreadData()</span><br><span class="line">        threadData.reset()</span><br><span class="line"></span><br><span class="line">        conf.paramDict = &#123;&#125;</span><br><span class="line">        conf.parameters = &#123;&#125;</span><br><span class="line">        conf.hashDBFile = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        _setKnowledgeBaseAttributes(<span class="literal">False</span>)</span><br><span class="line">        _restoreMergedOptions()</span><br><span class="line">        _setDBMS() <span class="comment">#强制设置DBMS</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> conf.data:</span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">_</span>(<span class="params">six.text_type</span>):</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        kb.postUrlEncode = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> conf.httpHeaders:</span><br><span class="line">            <span class="keyword">if</span> key.upper() == HTTP_HEADER.CONTENT_TYPE.upper():</span><br><span class="line">                kb.postUrlEncode = <span class="string">&quot;urlencoded&quot;</span> <span class="keyword">in</span> value</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> kb.postUrlEncode:</span><br><span class="line">        <span class="comment">#如果有urlencode会进行urldecode操作</span></span><br><span class="line">            original = conf.data</span><br><span class="line">            conf.data = _(urldecode(conf.data))</span><br><span class="line">            <span class="built_in">setattr</span>(conf.data, UNENCODED_ORIGINAL_VALUE, original)</span><br><span class="line">            kb.postSpaceToPlus = <span class="string">&#x27;+&#x27;</span> <span class="keyword">in</span> original</span><br><span class="line"></span><br><span class="line">    match = re.search(INJECT_HERE_REGEX, <span class="string">&quot;%s %s %s&quot;</span> % (conf.url, conf.data, conf.httpHeaders))</span><br><span class="line">    kb.customInjectionMark = match.group(<span class="number">0</span>) <span class="keyword">if</span> match <span class="keyword">else</span> CUSTOM_INJECTION_MARK_CHAR</span><br><span class="line">    <span class="comment">#CUSTOM_INJECTION_MARK_CHAR = &#x27;*&#x27;自定义注入标记字符</span></span><br><span class="line">    <span class="comment">#INJECT_HERE_REGEX = r&quot;(?i)%INJECT[_ ]?HERE%&quot;</span></span><br></pre></td></tr></table></figure>



<p><strong>setupTargetEnv()</strong></p>
<p>设置目标环境</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setupTargetEnv</span>():</span></span><br><span class="line">    _createTargetDirs() <span class="comment">#创建输出目录</span></span><br><span class="line">    _setRequestParams() </span><br><span class="line">    <span class="comment">#检查、设置参数GET参数，还有POST中的--data内容</span></span><br><span class="line">    <span class="comment">#检测注入标记字符，是否测试自定义注入点</span></span><br><span class="line">    <span class="comment">#接下来基于注入标记一堆交互操作进行测试</span></span><br><span class="line">    _setHashDB()</span><br><span class="line">    _resumeHashDBValues()</span><br><span class="line">    _setResultsFile() <span class="comment">#创建用于存储多目标模式运行结果的文件</span></span><br><span class="line">    _setAuthCred() <span class="comment">#将当前目标的身份验证凭据添加到密码管理器（由连接处理程序使用）</span></span><br><span class="line">    _setAuxOptions() </span><br></pre></td></tr></table></figure>



<p><strong>action()</strong></p>
<p>函数用于在受影响的URL参数上执行SQL注入攻击，并尝试提取 DBMS 或 操作系统相关信息</p>
<p>conf.direct = False</p>
<p>在没有直连数据库的情况下，将配置文件中的url、method、data、cookie添加到<strong>kb.targets</strong>中，接着判断如果不存在目标则报错，存在目标则打印出目标数</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211127194659375.png" alt="image-20211127194659375"></p>
<p>判断网络连接状况，打印错误信息</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211127200035159.png" alt="image-20211127200035159"></p>
<p>设置Http连接参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">initTargetEnv() //详见上文parseTargetUrl() //解析url获取信息（hostname、scheme...）</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211127200336549.png" alt="image-20211127200336549"></p>
<p><strong>kb.testedParams</strong>用于保存测试过的url参数信息，通过这个来判断url是否进行过test并且是否为注入点等，再来对<strong>testSqlinj</strong>进行修改，最后判断是否要跳过这个点</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211127201921315.png" alt="image-20211127201921315"></p>
<p>接下来判断是否存在多目标，依次交互来确认是否进行测试。</p>
<p>**setupTargetEnv()**上文有不继续讲了（可能讲的不对= =）</p>
<p>检查连接、是否有用户自定义的字符或者正则，即</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CUSTOM_INJECTION_MARK_CHAR = &#x27;*&#x27; //自定义注入标记字符INJECT_HERE_REGEX = r&quot;(?i)%INJECT[_ ]?HERE%&quot; //正则</span><br></pre></td></tr></table></figure>

<p>**checkWaf()**，详见下文分析</p>
<p><strong>checkNullConnection()<strong>可以参考一下<a target="_blank" rel="noopener" href="http://www.wisec.it/sectou.php?id=472f952d79293">链接</a>。大概就是在进行盲注时，不用获取整个页面响应主体内容，但能通过类似</strong>Content-Length header</strong>知道内容长度，以此来节省带宽的一种操作。</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211130203726347.png" alt="image-20211130203726347"></p>
<p><strong>checkStability()<strong>用于检查URL稳定性，两次请求同一页面并在两次访问中带有延迟来确保稳定，如果两次请求的内容有差异（动态页面）则通过</strong>–string</strong>来判断是否为同一页面，接着对参数列表和测试列表进行排序。</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211130204237981.png" alt="image-20211130204237981"></p>
<p>根据用户选择的**–level**来判断是否进行cookie、referer、ua的注入以及参数的跳过</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211206140046839.png" alt="image-20211206140046839"></p>
<p>其中557行处的**checkDynParam()**函数判断参数是否是动态，如果不是动态则需要选取其他参数。其核心是给参数另外一个随机值，然后通过选择参数及对于页面的各种规则的判断，计算出两个页面的相似比率，来判定是否为动态。</p>
<p>如果参数为动态，进入SQL注入测试，调用**heuristcCheckSqlInjection()**函数进行启发式检测，函数分析见下文。</p>
<p>得到<strong>POSITIVE</strong>结果后调用<strong>checkSqlInjection()<strong>进行注入点检查，再次确定有漏洞并且非</strong>FALSE_POSTTIVE</strong>，会设置injectable 设为True（可注入），中间产的数据会放入数据集中</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211206140706106.png" alt="image-20211206140706106"></p>
<p>没有检测出漏洞点的情况下，会根据情况提供建议参数</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211206140954358.png" alt="image-20211206140954358"></p>
<p>否则讲结果进行保存</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211206141110043.png" alt="image-20211206141110043"></p>
<p>确认有注入点后，会与用户进行交互确认，执行**action()**函数。</p>
<p>下面是except异常处理，不细说。</p>
<p>显示http错误代码，提示最大连接限制</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211206141446717.png" alt="image-20211206141446717"></p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211206141544427.png" alt="image-20211206141544427"></p>
<h4 id="checkWaf"><a href="#checkWaf" class="headerlink" title="checkWaf()"></a><strong>checkWaf()</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkWaf</span>():</span>    <span class="comment">#如果使用了自定义的参数或者跳过检测会直接return None，跳过waf检测    if any((conf.string, conf.notString, conf.regexp, conf.dummy, conf.offline, conf.skipWaf)):        return None    #判断原始状态码，不存在则return None    if kb.originalCode == _http_client.NOT_FOUND:        return None    #取出之前测试存储的数据，判断之前测试的时候有没有waf，如果取出数据不为空，则与探测发现目标地址存在WAF/IPS设备防御    _ = hashDBRetrieve(HASHDB_KEYS.CHECK_WAF_RESULT, True)    if _ is not None:        if _:            warnMsg = &quot;previous heuristics detected that the target &quot;            warnMsg += &quot;is protected by some kind of WAF/IPS&quot;            logger.critical(warnMsg)        return _    #不存在原始界面    if not kb.originalPage:        return None    infoMsg = &quot;checking if the target is protected by &quot;    infoMsg += &quot;some kind of WAF/IPS&quot;    logger.info(infoMsg)</span></span><br></pre></td></tr></table></figure>

<p>payload由随机数字和sqlmap提前设置好的payload来进行WAF检测</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">retVal = False    payload = &quot;%d %s&quot; % (randomInt(), IPS_WAF_CHECK_PAYLOAD)</span><br></pre></td></tr></table></figure>

<p><strong>IPS_WAF_CHECK_PAYLOAD</strong>位置：lib/cpre/settings.py</p>
<p>可以看到包括了xss、sql、命令执行等</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Payload used for checking of existence of WAF/IPS (dummier the better)IPS_WAF_CHECK_PAYLOAD = &quot;AND 1=1 UNION ALL SELECT 1,NULL,&#x27;&lt;script&gt;alert(\&quot;XSS\&quot;)&lt;/script&gt;&#x27;,table_name FROM information_schema.tables WHERE 2&gt;1--/**/; EXEC xp_cmdshell(&#x27;cat ../../../etc/passwd&#x27;)#&quot;</span></span><br></pre></td></tr></table></figure>

<p>将payload进行拼接，根据是否重定向进行参数配置。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> PLACE.URI <span class="keyword">in</span> conf.parameters:        place = PLACE.POST        value = <span class="string">&quot;%s=%s&quot;</span> % (randomStr(), agent.addPayloadDelimiters(payload))    <span class="keyword">else</span>:        place = PLACE.GET        value = <span class="string">&quot;&quot;</span> <span class="keyword">if</span> <span class="keyword">not</span> conf.parameters.get(PLACE.GET) <span class="keyword">else</span> conf.parameters[PLACE.GET] + DEFAULT_GET_POST_DELIMITER        value += <span class="string">&quot;%s=%s&quot;</span> % (randomStr(), agent.addPayloadDelimiters(payload))    pushValue(kb.choices.redirect)    pushValue(kb.resendPostOnRedirect)    pushValue(conf.timeout)    kb.choices.redirect = REDIRECTION.YES    kb.resendPostOnRedirect = <span class="literal">False</span>    conf.timeout = IPS_WAF_CHECK_TIMEOUT    <span class="keyword">try</span>:        <span class="comment">#queryPage()这个函数用于获取目标页面内容并返回页面比例（0&lt;=ratio&lt;=1）或者表示布尔值(0||1)，如果这个值小于0.5（IPS_WAF_CHECK_RATIO）则返回True存在WAF，反之False则不存在WAF        retVal = (Request.queryPage(place=place, value=value, getRatioValue=True, noteResponseTime=False, silent=True, raise404=False, disableTampering=True)[1] or 0) &lt; IPS_WAF_CHECK_RATIO    except SqlmapConnectionException:        retVal = True    finally:        kb.matchRatio = None</span></span><br></pre></td></tr></table></figure>

<p>测试完毕，将结果写入数据库，并根据结果进行用户交互。</p>
<p>目标可能存在某种WAF/IPS，是否进行更深度的测试。如果没有**–tamper**会让你考虑使用tamper脚本绕过WAF。</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211130193414009.png" alt="image-20211130193414009"></p>
<h4 id="identYwaf"><a href="#identYwaf" class="headerlink" title="identYwaf"></a>identYwaf</h4><p>Sqlmap有个插件用于识别WAF指纹，该插件位于：**/thirdparty/identywaf/identYwaf.py**</p>
<p>通过全局搜索可以发现在**/lib/request/basic.py** 中的<strong>processResponse()<strong>函数引用该插件，</strong>processResponse()<strong>又在</strong>lib/request/connect.py</strong>中的**getPage()<strong>，而</strong>getPage()<strong>的调用场景就比较多了，在Sqlmap需要获取页面信息的时候就会调用这个函数（还记得</strong>checkWaf()**中有一段代码比较返回页面内容比例么？），有点绕梳理一下过程。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getPage()-&gt;processResponse()-&gt;identYwaf.py</span><br></pre></td></tr></table></figure>



<p>来简单看一下<strong>processResponse()</strong></p>
<p>**parseResponse()**函数根据web应用返回的DBMS错误信息中后端DBMS指纹来检测判断可能的后台数据库。</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207160143521.png" alt="image-20211207160143521"></p>
<p>接着<strong>if</strong>比较了<strong>kb.processResponseCounter</strong> 和<strong>IDENTYWAF_PARSE_LIMIT</strong>，前者每次调用**processResponse()**加1，后者默认为10。可以看到这里会打印出WAF/IPS的识别结果</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207160312902.png" alt="image-20211207160312902"></p>
<p>具体看下<strong>non_blind_check()<strong>，这里进行了一个正则匹配，匹配</strong>WAF_RECOGNITION_REGEX</strong>、<strong>rawResponse</strong>或””中的内容，将匹配到的结果加入non_blind中。</p>
<p><strong>WAF_RECOGNITION_REGEX</strong>为<strong>identYwafA.py</strong>中的一个全局变量，通过<strong>load_data()<strong>从</strong>data.json</strong>导入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">non_blind_check</span>(<span class="params">raw, silent=<span class="literal">False</span></span>):</span>    retval = <span class="literal">False</span>    match = re.search(WAF_RECOGNITION_REGEX, raw <span class="keyword">or</span> <span class="string">&quot;&quot;</span>)    <span class="keyword">if</span> match:        retval = <span class="literal">True</span>        <span class="keyword">for</span> _ <span class="keyword">in</span> match.groupdict():            <span class="keyword">if</span> match.group(_):                waf = re.sub(<span class="string">r&quot;\Awaf_&quot;</span>, <span class="string">&quot;&quot;</span>, _)                non_blind.add(waf)                <span class="keyword">if</span> <span class="keyword">not</span> silent:                    single_print(colorize(<span class="string">&quot;[+] non-blind match: &#x27;%s&#x27;%s&quot;</span> % (format_name(waf), <span class="number">20</span> * <span class="string">&#x27; &#x27;</span>)))    <span class="keyword">return</span> retval</span><br></pre></td></tr></table></figure>

<p>下面是<strong>data.json</strong>中关于waf的部分截图</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207161722271.png" alt="image-20211207161722271"></p>
<p>Sqlmap通过Payload检测目标是否有WAF，<strong>processResponse</strong>会跑十次，通过十次连接返回的结果并进行正则匹配来识别WAF指纹信息</p>
<h4 id="heuristcCheckSqlInjection"><a href="#heuristcCheckSqlInjection" class="headerlink" title="heuristcCheckSqlInjection()"></a>heuristcCheckSqlInjection()</h4><p>启发式注入，用各种payload进行测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">check = heuristicCheckSqlInjection(place, parameter)</span><br></pre></td></tr></table></figure>

<p>开始从conf中拿数据，包括是否跳过测试</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207191644488.png" alt="image-20211207191644488"></p>
<p>自定义前后缀，下面举个例子</p>
<blockquote>
<p>prefix: ‘)’</p>
<p>suffix: ‘AND ([RANDNUM]=[RANDNUM]’</p>
<p>假设的完整payload：1) AND 7862=7862 AND (9976=9976</p>
</blockquote>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207193008973.png" alt="image-20211207193008973"></p>
<p>生成随机字符串，例如<code>&#39;),)\&#39;.&quot;,(.)&#39;</code>，其中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Alphabet used for heuristic checksHEURISTIC_CHECK_ALPHABET = (&#x27;&quot;&#x27;, &#x27;\&#x27;&#x27;, &#x27;)&#x27;, &#x27;(&#x27;, &#x27;,&#x27;, &#x27;.&#x27;)</span></span><br></pre></td></tr></table></figure>

<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207193110200.png" alt="image-20211207193110200"></p>
<p>对payload进行拼接，并用**queryPage()**比对页面相似度</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207193436099.png" alt="image-20211207193436099"></p>
<p>接下来两个函数<strong>parseFilePaths()<strong>和</strong>wasLastResponseDBMSError()</strong></p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207194325930.png" alt="image-20211207194325930"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parseFilePaths(page) <span class="comment">#检测页面中（可能的）系统绝对路径wasLastResponseDBMSError() #检测是否出现（可识别的）数据库报错</span></span><br></pre></td></tr></table></figure>

<p>检测服务端是否存在格式化参数出现报错信息的情况</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207195446474.png" alt="image-20211207195446474"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Strings for detecting formatting errorsFORMAT_EXCEPTION_STRINGS = (&quot;Type mismatch&quot;, &quot;Error converting&quot;, &quot;Please enter a&quot;, &quot;Conversion failed&quot;, &quot;String or binary data would be truncated&quot;, &quot;Failed to convert&quot;, &quot;unable to interpret text value&quot;, &quot;Input string was not in a correct format&quot;, &quot;System.FormatException&quot;, &quot;java.lang.NumberFormatException&quot;, &quot;ValueError: invalid literal&quot;, &quot;TypeMismatchException&quot;, &quot;CF_SQL_INTEGER&quot;, &quot;CF_SQL_NUMERIC&quot;, &quot; for CFSQLTYPE &quot;, &quot;cfqueryparam cfsqltype&quot;, &quot;InvalidParamTypeException&quot;, &quot;Invalid parameter type&quot;, &quot;Attribute validation error for tag&quot;, &quot;is not of type numeric&quot;, &quot;&lt;cfif Not IsNumeric(&quot;, &quot;invalid input syntax for integer&quot;, &quot;invalid input syntax for type&quot;, &quot;invalid number&quot;, &quot;character to number conversion error&quot;, &quot;unable to interpret text value&quot;, &quot;String was not recognized as a valid&quot;, &quot;Convert.ToInt&quot;, &quot;cannot be converted to a &quot;, &quot;InvalidDataException&quot;, &quot;Arguments are of the wrong type&quot;)</span></span><br></pre></td></tr></table></figure>

<p>采用了数字型的payload，例如原始页面id=3，随机生成了4，那么现在请求为id=7-4，利用**queryPage()**来比较页面相似度。</p>
<p>如果数字型返回结果为False则用字符型再试一次，例如原始页面id=3，生成id=3aaa，利用**queryPage()**来比较页面相似度。</p>
<p>根据结果对<strong>casting</strong>赋值（True or False）。</p>
<p>下面这个heavilyDynamic似乎是页面动态性过强时，直接就报错退出了</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207200147236.png" alt="image-20211207200147236"></p>
<p>当casting为True时，根据 URL split 拆分得到可能的后端语言，并根据不同语言给出可能的处理参数方式，有两种可能走到这个位置：</p>
<p>1.格式化参数出现报错信息，即上文**def _(page)**处。</p>
<p>2.id=3和id=3aaa通过**queryPage()**来比较页面相似度，得到的返回值为True，即页面返回结果相同（字符型）</p>
<p>通过这种方式可以基本判断服务端处理参数的方式。</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207204739859.png" alt="image-20211207204739859"></p>
<p>当result为True时，id=3和id=7-4页面相似度高（数字型），通过**getErrorParsedDBMSes()**获取可能的后端数据库类型，否则提示“not be injectable”</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207210215547.png" alt="image-20211207210215547"></p>
<p>在注入检测完毕后，还会进行简单的XSS和文件包含漏洞检测（很基础，基本没啥用）</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211207210543310.png" alt="image-20211207210543310"></p>
<h4 id="checkSqlInjection"><a href="#checkSqlInjection" class="headerlink" title="checkSqlInjection()"></a>checkSqlInjection()</h4><p>检测是否存在SQL注入的核心函数</p>
<p>**InjectionDict()**顾名思义是一个字典，用于存储一些注入成功的边界值和payload数据（边界值应该就是payload的前后缀信息）</p>
<p>**isDigit()<strong>和</strong>isalpha()**这些是根据已知参数来对boundaries进行排序筛选</p>
<p>**getSortedInjectionTests()<strong>的作用是从错误消息中检测到的DBMS返回优先测试列表，测试项对应的payload在</strong>/data/xml/payloads/<strong>，在</strong>init()<strong>中通过</strong>loadPayloads()**加载</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211210165757597.png" alt="image-20211210165757597"></p>
<p>下图两张payload的具体样例（上为联合注入，下为布尔盲注）</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211210172123327.png" alt="image-20211210172123327"></p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211210173415957.png" alt="image-20211210173415957"></p>
<blockquote>
<p>text标签包含的信息：</p>
<p>title：测试名称或者说测试输出标题</p>
<p>stype：注入类型，Sqlmap支持六种注入类型（1-6）。&lt;1：布尔盲注；2：报错注入；3：内联注入；4：堆叠注入；5：时间盲注；6：联合注入&gt;</p>
<p>level：测试等级（1-5）</p>
<p>risk：风险等级，可能对数据库造成的风险（1-3）</p>
<p>clause：表示对应的测试payload适用于哪种类型的SQL语句。&lt;0：Always；1：Where/Having&gt;；2：Group by；3：Order by；4：Limit；5：Offset；6：Top；7：Table name；8：Column name；9：Pre-WHERE（non-query）</p>
<p>where：如何添加完整的payload（1-3）。&lt;1：在原始值后面添加payload；2：将原始值替换为不存在的随机字符串后添加payload；3：用payload替换原始值&gt;</p>
<p>vector：payload大概的样子，在具体测试中受前后缀和tamper脚本等影响payload不一定和vector中的内容相同</p>
<p>request：发起请求的配置。其中不可缺少payload，comment不一定有，char和columns只有UNION中存在</p>
<p>payload：实际测试使用的payload</p>
<p>comment：注释，放在后缀前</p>
<p>char：UNION特有字段，用于爆破字段数量</p>
<p>columns：UNION特有字段，用于查询字段范围</p>
<p>response：判断payload注入成功与否</p>
<p>*comparison：布尔盲注特有字段，用于对比request中请求结果</p>
<p>grep：报错注入特有字段，使用正则表达式匹配请求结果</p>
<p>time：时间盲注特有字段，等待时间</p>
<p>*union：处理联合注入的方法</p>
<p>details：根据response标签得出的结果，比如，得出数据库类型（dbms）</p>
<p>dbms：数据库类型</p>
<p>dbms_version：数据库版本</p>
<p>os：操作系统</p>
</blockquote>
<p>第一个<strong>if</strong>判断是否停止检测。</p>
<p>第二个<strong>if</strong>判断是否指纹识别出后台数据库，如果没有识别将采用布尔盲注的形式对数据库进行检测。</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211210190454459.png" alt="image-20211210190454459"></p>
<p>检测利用了**heuristicCheckDbms()**这个函数，关键代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> dbms <span class="keyword">in</span> getPublicTypeMembers(DBMS, <span class="literal">True</span>):    randStr1, randStr2 = randomStr(), randomStr()    Backend.forceDbms(dbms)    <span class="keyword">if</span> dbms <span class="keyword">in</span> HEURISTIC_NULL_EVAL:        result = checkBooleanExpression(<span class="string">&quot;(SELECT %s%s) IS NULL&quot;</span> % (HEURISTIC_NULL_EVAL[dbms], FROM_DUMMY_TABLE.get(dbms, <span class="string">&quot;&quot;</span>)))    <span class="keyword">elif</span> <span class="keyword">not</span> ((randStr1 <span class="keyword">in</span> unescaper.escape(<span class="string">&quot;&#x27;%s&#x27;&quot;</span> % randStr1)) <span class="keyword">and</span> <span class="built_in">list</span>(FROM_DUMMY_TABLE.values()).count(FROM_DUMMY_TABLE.get(dbms, <span class="string">&quot;&quot;</span>)) != <span class="number">1</span>):        result = checkBooleanExpression(<span class="string">&quot;(SELECT &#x27;%s&#x27;%s)=%s%s%s&quot;</span> % (randStr1, FROM_DUMMY_TABLE.get(dbms, <span class="string">&quot;&quot;</span>), SINGLE_QUOTE_MARKER, randStr1, SINGLE_QUOTE_MARKER))    <span class="keyword">else</span>:        result = <span class="literal">False</span>    <span class="keyword">if</span> result:        <span class="keyword">if</span> <span class="keyword">not</span> checkBooleanExpression(<span class="string">&quot;(SELECT &#x27;%s&#x27;%s)=%s%s%s&quot;</span> % (randStr1, FROM_DUMMY_TABLE.get(dbms, <span class="string">&quot;&quot;</span>), SINGLE_QUOTE_MARKER, randStr2, SINGLE_QUOTE_MARKER)):            retVal = dbms            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>其中<strong>FROM_DUMMY_TABLE</strong>为不同数据库所特有的表</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211210192009838.png" alt="image-20211210192009838"></p>
<p>除了这种方式，不同数据库的查询语句不同，根据payload的测试情况也能判断对应的数据库类型</p>
<p>判断出数据库类型以后，与用户进行简单交互以及属性配置</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211210194445492.png" alt="image-20211210194445492"></p>
<p>接下来是<strong>联合查询</strong>，其中包括了是否指定列的范围等</p>
<p>。。。</p>
<p>判断是否指定注入技术</p>
<p>如果为相同的sql注入类型，则跳过</p>
<p>解析DBMS特有payload信息</p>
<p>。。。</p>
<p>（各种测试跳过判断）</p>
<p>这里根据测试来强制转换数据库类型，保证payload是对应当前数据库的</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211210195555393.png" alt="image-20211210195555393"></p>
<p>接下来的一段代码直到布尔盲注之前，主要是在分析确定payload拼接的前后缀、参数类型以及为接下来的测试铺垫（主要是关于拼接的内容），其中用户通过**–prefix<strong>和</strong>–suffix**设定的前后缀拥有更高的优先级</p>
<p>接下来是不同类型的注入：</p>
<h5 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h5><p>首先生成payload</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211214174351461.png" alt="image-20211214174351461"></p>
<p>这里的请求包括了三种情况：</p>
<blockquote>
<p>正常请求：id=1</p>
<p>正逻辑请求：id=1 or 1=1</p>
<p>负逻辑请求：id=1 or 1=2</p>
</blockquote>
<p>对比包括了两种情况：</p>
<blockquote>
<p>1、正常请求与负逻辑进行对比</p>
<p>2、负逻辑、原始界面（正常请求）和启发性测试对比</p>
</blockquote>
<p>通过获取的不同页面进行比较</p>
<p>①正常响应与正逻辑响应是否相同</p>
<p>②在①的前提下比较负逻辑响应和正常响应</p>
<p>③发送错误的payload并与正常请求进行比较</p>
<p>总之就是通过对不同响应页面进行比较来判断是否存在注入点。</p>
<p>在这之后如果用户输入的参数中带有**–string<strong>或者</strong>–code**即指定了判断的识别字符或者状态码，也会对是否存在注入点的判断产生影响</p>
<p>具体代码就不贴了</p>
<h5 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h5><p>代码很短</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211214191454063.png" alt="image-20211214191454063"></p>
<p>这里对报错注入判断逻辑比较简单，利用了正则匹配</p>
<p>（上文在分析Sqlmap的payload中各种标签作用时提到了报错注入特有的<strong>grep</strong>标签）</p>
<p>存在以下情况中的任意一种符合<strong>grep</strong>则判断为可注入：</p>
<blockquote>
<p>1、页面内容错误</p>
<p>2、HTTP的错误响应（例如：500）</p>
<p>3、header中的内容</p>
<p>4、重定向信息</p>
</blockquote>
<h5 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h5><p>懂得都懂，就是设置了sleep以后响应时间是否变长来判断</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211214193343059.png" alt="image-20211214193343059"></p>
<p>这里调用queryPage()函数时，设置了参数<strong>timeBasedCompare = True</strong>，可以跟进看下用来干嘛</p>
<p>当时间比较参数为真，会调用**wasLastResponseDelayed()**函数，这个函数就是在请求存在时间延迟时返回True</p>
<p><strong>wasLastResponseDelayed()</strong></p>
<p>结合一下给的注释来理解，这里先获取几次访问的响应时间（生成了一个响应时间的列表），并且利用**stdev()**计算出标准差</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215152011217.png" alt="image-20211215152011217"></p>
<p><strong>MIN_TIME_RESPONSES = 30</strong>，如果列表中的响应时间数小于30，则<strong>if</strong>语句会一直循环直到30次</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215152421341.png" alt="image-20211215152421341"></p>
<p><strong>TIME_STDEV_COEFF = 7</strong>，<strong>lowerStdLimit</strong> = 7*标准差 + 响应时间列表的算术平均值</p>
<p><strong>MIN_VALID_DELAYED_RESPONSE = 0.5</strong>，计算出来的下限值和最小有效延迟进行比较</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215153713508.png" alt="image-20211215153713508"></p>
<p>跳出上一个循环后，会询问用户是否优化延迟响应的值（time-sec = 5），如果选自了<strong>Yes</strong>则会使用**adjustTimeDelay()**函数进行计算调整</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215154456661.png" alt="image-20211215154456661"></p>
<p>这里又减掉了5(s)，Why？</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215154550048.png" alt="image-20211215154550048"></p>
<p>这里采用的时间流程为：</p>
<blockquote>
<p>1’ AND SLEEP(5) AND ‘xxxx’ = ‘xxxx</p>
<p>1’ AND SLEEP(0) AND ‘xxxx’ = ‘xxxx</p>
<p>1’ AND SLEEP(5) AND ‘xxxx’ = ‘xxxx</p>
</blockquote>
<p>由此根据响应结果来判断是否存在时间盲注</p>
<p>sqlmap对时间盲注的判断是只要 超过标准的延迟时间就认为是有延迟了而不是直接判断测试的延迟时间</p>
<h5 id="联合查询"><a href="#联合查询" class="headerlink" title="联合查询"></a>联合查询</h5><p>这里干了几件事：</p>
<blockquote>
<p>1、进行了初始配置 char = NULL,columns = 1-20</p>
<p>2、判断是否识别出数据库类型，如果没有可以尝试通过**–dbms**设置</p>
<p>3、自动扩展 UNION 查询注入技术测试的范围，因为至少发现了一种其他（潜在）技术  ps：这条不是很懂</p>
</blockquote>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215162625545.png" alt="image-20211215162625545"></p>
<p>这里是关键</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215202300874.png" alt="image-20211215202300874"></p>
<p><strong>unionTest()</strong></p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215202401388.png" alt="image-20211215202401388"></p>
<p>其中的核心函数**_unionTestByCharBruteforce()**</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/KZY]XCJTV6A3K8XFYL4IHUQ.png" alt="img"></p>
<p>其中的**_findUnionCharCount()<strong>和</strong>_unionConfirm()**分别来看下</p>
<p><strong>_findUnionCharCount()</strong></p>
<p>其中定义了**_orderByTest()<strong>函数，和手工注入利用order by测列数原理一样，这里拼接好payload以后，通过</strong>queryPage()**对比页面来判断。</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215203737369.png" alt="image-20211215203737369"></p>
<p>下面代码中利用了二分法，节省判断时间</p>
<p>如果order by失效，还会调用<strong>agent.py</strong>中的**forgeUnionQuery()**函数。这个函数的作用是输入一个查询字符串并返回其处理过的UNION ALL SELECT 查询。 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Examples:MySQL input: CONCAT(CHAR(120,121,75,102,103,89),IFNULL(CAST(user AS CHAR(10000)), CHAR(32)),CHAR(106,98,66,73,109,81),IFNULL(CAST(password AS CHAR(10000)), CHAR(32)),CHAR(105,73,99,89,69,74)) FROM mysql.userMySQL output:UNION ALL SELECT NULL, CONCAT(CHAR(120,121,75,102,103,89),IFNULL(CAST(user AS CHAR(10000)), CHAR(32)),CHAR(106,98,66,73,109,81),IFNULL(CAST(password AS CHAR(10000)), CHAR(32)),CHAR(105,73,99,89,69,74)), NULL FROM mysql.user-- AND 7488=7488</span><br></pre></td></tr></table></figure>



<p><strong>_unionConfirm()</strong></p>
<p>找到了列数后，接着寻找输出点，只需要将 UNION SELECT NULL,NULL,….,NULL 中的NULL依次替换，然后在结果中寻找插入的随机的字符串，就可以定位到输出点的位置，主要用到了**_unionPosition()**</p>
<p>**_unionPosition()<strong>中也调用了</strong>forgeUnionQuery()**函数</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215210924072.png" alt="image-20211215210924072"></p>
<p>下面是判断用户是否在检测阶段终止检测</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215213508641.png" alt="image-20211215213508641"></p>
<p>最后返回注入结果</p>
<p>其中的三个函数**checkFalsePositives()<strong>、</strong>checkSuhosinPatch()<strong>、</strong>checkFilteredChars()**，作用如下：</p>
<p>1、检查误报</p>
<p>2、检测Suhosin或者其他保护机制（<em>Suhosin</em>是一个PHP程序的保护系统）</p>
<p>3、检查过滤字符</p>
<p><img src="https://blog-jasonttu.oss-cn-hangzhou.aliyuncs.com/img/image-20211215213527910.png" alt="image-20211215213527910"></p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>附上一张<a target="_blank" rel="noopener" href="https://www.processon.com/view/5835511ce4b0620292bd7285#pc">sqlmap源码流程图</a></p>
<p>第一次看工具代码 可能写的有点乱 有问题欢迎指出交流</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Python/" rel="tag"># Python</a>
              <a href="/tags/sqlmap/" rel="tag"># sqlmap</a>
              <a href="/tags/%E5%B7%A5%E5%85%B7%E5%88%86%E6%9E%90/" rel="tag"># 工具分析</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/01/07/HackTheBox-theNotebook/" rel="prev" title="HackTheBox-theNotebook">
                  <i class="fa fa-chevron-left"></i> HackTheBox-theNotebook
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/01/12/VulnHub-EvilBox/" rel="next" title="VulnHub-EvilBox">
                  VulnHub-EvilBox <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jason Tu</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
